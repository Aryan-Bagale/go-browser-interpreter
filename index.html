<!DOCTYPE html>
<html lang="en">
<head>
    <!-- Character encoding (important for symbols & emojis) -->
    <meta charset="utf-8">

    <!-- Text shown in the browser tab -->
    <title>Go WASM Interpreter</title>

    <!-- Load external CSS file for styling -->
    <link rel="stylesheet" href="style.css">
</head>

<body>
    <!-- Page title -->
    <h1>Go Client-Side Interpreter</h1>

    <!-- Short description -->
    <p>
        Type Go code below. It runs entirely in your browser using
        WebAssembly and the Yaegi interpreter.
    </p>

    <!--
        Text area where the user writes Go code.
        This can be a complete Go program.
    -->
    <textarea id="code">
package main

import "fmt"

func main() {
    fmt.Println("Hello from WSL + WASM!")
    fmt.Println("Calculation:", 5 * 5)
}
    </textarea>

    <br>

    <!--
        Button that triggers code execution.
        When clicked, it calls the execute() function in JavaScript.
    -->
    <button onclick="execute()">Run Code</button>

    <!--
        Output area where the program result or errors are shown.
    -->
    <div id="output">Loading WASM... (please wait)</div>

    <!--
        wasm_exec.js is provided by the Go toolchain.
        It allows JavaScript to run Go WebAssembly programs.
    -->
    <script src="wasm_exec.js"></script>

    <script>
        /*
            Create a new Go runtime instance.
            The "Go" class is defined in wasm_exec.js.
        */
        const go = new Go();

        /*
            Load the compiled WebAssembly file (main.wasm)
            and start the Go runtime.
        */
        WebAssembly.instantiateStreaming(
            fetch("main.wasm"),
            go.importObject
        ).then((result) => {
            // Start the Go program (calls main() in Go)
            go.run(result.instance);

            // Update UI to show readiness
            document.getElementById("output").innerText = "Ready.";
        }).catch((err) => {
            // Show error if WASM fails to load
            document.getElementById("output").innerText =
                "Failed to load WASM: " + err;
        });

        /*
            Called when the user clicks the "Run Code" button.
            It sends the code to Go and displays the output.
        */
        function execute() {
            // Get Go code from textarea
            const code = document.getElementById("code").value;

            /*
                runGoCode() is a function written in Go
                and exposed to JavaScript using syscall/js.
            */
            const result = runGoCode(code);

            // Display the result in the output box
            document.getElementById("output").innerText = result;
        }
    </script>
</body>
</html>
